<?php

namespace Oka\Doctrine\Tests\Types;

use Doctrine\DBAL\Platforms\MySQL57Platform;
use Doctrine\DBAL\Types\Type;
use Oka\Doctrine\Types\JsonSecretType;
use PHPUnit\Framework\TestCase;

/**
 * @author Cedrick Oka Baidai <cedric.baidai@veone.net>
 */
class JsonSecretTypeTest extends TestCase
{
    public function testThatWeCanconvert()
    {
        $platform = new MySQL57Platform();
        Type::addType('json_secret', JsonSecretType::class);
        /** @var \Oka\Doctrine\Types\JsonSecretType $type */
        $type = Type::getType('json_secret');
        $type->setPrivateKeyPath(getenv('OPENSSL_PRIVATE_KEY'));
        $type->setPublicKeyPath(getenv('OPENSSL_PUBLIC_KEY'));
        $type->setPassPhrase(getenv('OPENSSL_PASSPHRASE'));

        $phpValue = ['icon' => 'data'];
        $databaseValue = $type->convertToDatabaseValue($phpValue, $platform);

        $this->assertEquals($phpValue, $type->convertToPHPValue($databaseValue, $platform));

        $phpValue = ['icon' => 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAawUlEQVR42u2dB3gV1bbHZ05L74UEEkIgoYUmIB2EKEhVBJSiSAnwKKJciheQIoIiRQUpUhQSWgiBJHQInYQ0SCMIeFFApej1qk+igFfg/9baM3NyTkgQgcD7ZOb71nfCnn32mbN+s8reZ/ZCKvwtTQIg3cJPjYE/1t64cf3i1atXCq9e/eVXXcpSrhSyroGb64BfmjCDwqtpkgrj5+5XrxWeS0hIQP/+A9ChQwddHoKwrlnnpPvzwJUezEK6eeuHxgzjrbfegqOjI7VIujxEYZ2z7q8RlFu3fmxKFvLfdUlJSXByctIV9AihJCYmkoH8ESvdvHn9YlRUlK6YRywDBw7EDWIhXbteWNi5cxddKY9YOnbsSLHkSqF07dqVX3Ugj144yHP2pQPRgeiiA9GB6KID0YHoogPRgeiiA3lE4uTEa0o6kP8XUq2mhPc/ktHiKR3Io11lJavo1ktCYrKMnC9kDBqqA3lkUqmyhKmzZRzIkZH+uYyskzLWbZIxdKSEwcMkvDpQwou9JXR6TsJTbSQ80UBCWLiEcgESXN0kmEw6kAcirMi2nSSs3iIj5QTJcRlHCmRk0N/HCEruFxLyWE4rkntSwrECCek5Eg6mSdi+R8K6eAnzFkl4c4KEXn0kNGkmISj4/mLQYwnEr5yENybK2Jkp4xCBOJQv4zADOa4AOUqWcuxzCdkEIYck95QieST5pxUpIFgn/kVyRnk9Tm1ZeRJ2H5CwPFrCqDGKRfn560DuKA2ayFi42oD9+SzkqvJkHFSBpJKkF9wZiCb5pYgGqoDkaD7Fpe0yxk+S0bCRBAcHHYhVnF0k9B4oI+EAgThuwL48es2zAZJfBCTrxL0D0cTa77Qs5HCmAbPnGdDgSRmy/JgDCQ6VMWWujORsBcTe3IcHJJfiUQ5ZXPbnBhrPiN2HTYgaahQ3yGMHRDZQoG1jwuINZuxRQWjCQFg0IBxHOLCnPWAgeRqQEwZkHTciI9+Ew8ccMHqCGU7O8uMDxNnNgB6DnRG91w1bSQG7sksGsr8EIJnFgGhQ7hUIWwkDOVpgRHqeCanZFuxJc6K5j/nxABIYYsHrs3ywKtUPcekeSMp0xM5sox2QvfcJJO+vAiErYSBsISkE5ECWE5asdoG3j+HvD6RKLWcMnOCHObF+WJviiS3HHLErx4g9ubdbiQCSVwTkiAqEM637AZJfDEiODRC2kP2ZTkjc54p6Dc2Ph8syGGT4BpjRop0TRr/jhJjtFEdyKGYcLzmwW+ciBUVzEQZy33HEDohBADmSw0DIao+4oVsfx8cvyzIaZQRVNKHLi2bMXGhG4iGjmIcwnDsBuZvAzhNCTXgOYic8YfxCSX3zTimZFgf2I7lmclmOSE53xZvTXOn6HhGQSrIRvQwOGGt0Rm969ZcNDx2Og6MBNWqbMHCEGcviTEg+ZsDhAgWGNjm0BZJzSllCOc6TvTNFShYKZveWQ66O5hj7UgzYtc+ILTuNSNhqwoZEE+ISFIlPMtEE0YTte03Yk2LGwUwLDhKQPekuWBjjAS9vw8MF4ibJGGp0whGzJ761+OASCb9uMLmjIkF6NJYjC0W0bmvC1NkmJNGEMYUUnPa5AiSLgZBl7E8zIC7RiKUrTJg5x4yx480YONiMF7qbEfmMGU82MqNmhBmhlc2oUMEEf38TvL1N8PQ0wsODhF69vIzw8zMhKNiEajXMaNrcgpET3LF8ow8+i/dBzTqWhwckiKxgickN3xCAiyoITS6TvGdygeEux3IlJTaQTahOEOUHutAoI7y6EQOHmxCzyYhUcmfZp5UFxn9ONsKdFOtIlmUwGATI+/288pUdMWp+CGZuCsf0mFA0bu32cIBUIcXFkxVoFnFBFQ0IA8o0ewlX9mdjPUkgVtNYpy3e4j2NZPPd/QJICnT9EyWyog0Gk/jbw1NC+84GzF9Cvp7c0QcLZTsfr/U3mUz3pJOwOo4Y90kwPtgehjlbwzB3ezU8+7Jf2QMJJSUnmD0EjAuq8k+SMr8gsYVyjqSdwXLHsTrT+aME4bI6Fr9Oojh0p/dYSLpTnIoliEl0HW0MtwOMiIjAxIkTERsbi82bN2P5suV45ZVXydV4w2KR0KipEX0HFC1z1KpVS+zhWL9+vei/bNky6v8KuSQvu3H79u2Lzz77DDNmzCD35a1AJKgNn3bB3PimyDm/Ase/jkPC0cGYFlsZNRu5li2QQHJTsaplMIgTBGGq0QX16C5vTYrZQ7Hkoo3V9DWUvkHoGYKRSzAuFnN1i8kNlubqHMkiJhCwr+hzue/3JJsIipuNpXTp0gVnz55F8ePmzZtC2RUqVLDGGn7t2rUrzp07V2J/3tNRvnx569jvv/++OHf9+nVERj4NJzcJzw3ywcyEithdMM763o0HJ6LB0652i40PHIgXfYGlpKyLavA+QMpnpdr6/Pb07zOqpXC/AcaSgdQigCn0fg3sBRsgS0oBwp8zkhKI8zb9+bWAPi9CVtxMcHAwCgoKhFJ+/PFHLF26FFOmTEFycrJQMB9z584lRSkwQkJCcPLkSdH+n//8B0uWLBH99+7di1u3bon2WbNmFX2/9u1x7do10b5g+TQMnhEoXNRHu6rg+Dfr1M/9Aa0iG5bt0okzwZhFQfqCCmMH3ZW15dt9rTf126sqmoN9D3Itxfv4kpWtV62Mx1tLf8eb3QUYBvKhybXk1VKCza7xYrEk4iyJ5rZ69eplVfzkyZOt7y1XrhwyMjJE+6lTpxAYGCja2S1pip8wYUKRJ6DzR48eFe0nTpygDMtfCdqB5fHFF6dF+5nL+zF3WwTFijAs2FUfl39WboSDBw/CxcW17ICYSN4kN/G1CoPdUoRsKhUcxxdW7JekvBbF/LuZ5B2ji9WCVpA1+EgGMX+5pAKZQudve2qE4tZB+lw+z7Eqlf7+RgXCFtNBjVUcB/i4evUqWrdubTfGwoULrZZQp04d0cbWwMevv/6Kli1b2vVn6+Lj3//+N2rWqAlHFxmNO/jhSH6iaP/5twuYFfcUXvqHH/oNj8SVK/8r2t99992yXX7vT26HlcsKSxdZkOmO85JtKpB8i5dQpO35Vw3KWHx+M/ULVieQDOmyCnx0saDOrjKawF1SrWEIua36dA1a/GEg7VUgrAw+rly5giZNmtiNw65HKPLnn9GgQQPRxsGZj19++QWNGze26z9v3jy1/0/oPaw1ek+qhDErqyM+VYH4x43/4tWB3UXfYUOHizZ2Z+zWygwI33kFKgwO4B3ulDUZZASZTUi1KFlTGimsgs2MnTOufBUGg62vguV4wYFcA/K6sWhzqgPBYFjapPMjcmecZXlQe7LqGjnAt1It8U5AtIB8t0AWLPxYsZ5r/4vpa15Ar7cqo0U3f3R4oSl++OEH1RreE33XrFkj/n369GmbpOEBA2GFsVL5S58xeaO/rARok9kAF3czfMs7IaSaO6o38Ead5n6o3dIfz9Xzw0knRXnsVsqpQDgLS7VxOS/YxBbOnOLUmMLnJ6gWwq5yFME5q7bvIovSZv+e9J5dqiV+TuPVUeFOnTrV6oJatGhR4h3Pwb5evXqibdq0aaKtsLAQzZo1g8EsISDcDQ2fD8SWg6vFuZ9+/hGtn30SZkclEXB2dhFxgg8O/qGhoSLO8MFgjEbjgwfCrmSLOtf41sEHC6r4okFzH7TsWh4d+1WiVK8y2vcNQfPO5RHR2IdmqK5w9ragtaODcEnsSo7T6xOkKFbWTnUs9vscj4zF3NxW9TxLDFkLp9fjqJ/mKvPoxmhpE48C6LwG+DC9BqjgeacrHxyohw8fXhTbnJ1FpsUHp8QVK1YU7UOGDLGmuBPf/Qci2vqhzrP+qBcZgvSjh5XgfeYMpb72d71mid9++y2GDh0qLIwPHu/B/qZOebOPoxFLzG7WbCa5YRBGTKyO3mPD0a5PMFmDDwJCnOHkaoJssJ8pR9Is+6xNBsQJQIbq61kWkctxKza75tn2Zg0+WyNB4AB+Xn0Pu6T+xdJnTptPqO7vbXJpWupdvXp1fP3110I5X331FV5//XV069YNixYtsqar0dHR1tk4TyAvXLgg2r+5eA7jJoxG9+7dsXjxJ2KuwQdPBIvf9Rwn+Pzvv/+OY8eOiRuA3VjdunUfDBBHZyMq13JFu5cCsLx+OXEnXzL7YK+/L7q2C0BYPQ+4kwUYjHdequC7mO9q2yUUbd7CE8rAElaBOfOKUWPItzaz/wuqRb1FlmIu9h62OrYaXsQMKjYmWwbHkJKO3Nxc1K5du2huQ/ORkSNHCpdV0pGdnS2gFb9mTqPz8vLs+u7cuVNY4n0BcfEwoWGkF/qND8GYxdURTa7onLuvgMEruPXN5CYMd+/qqpKPZ0XZLqFcUld/Q++wrjWelH7Z5j0aDF6gdClhvYqDPa+BlSsBMN/NvCec/TnfvezfDx8+jJkzZ6Jq1aolLECa0LlzZ6xdu1YA4P6HDh0SbiksLKzUa2Yr2bNnj+jPKwCNGjW69+eyDKTkiEZuGDytEqZEV8fkVTUxf2IYTpbzx0WzEig7/sk6VGlLGyvpbv9eBfG1uhQS9Ce/j7AL4szrOzWAn6LPZ0iu97ECy2A8PT3h6+tLEzWXB95fi03c38HB4d4flOMVzsiuHpi8sipmrK+BCZ9Ww8hhwTgSosDgRcHhlN3c6zI4B/KNZmXhrz/NO+5WqTy/4RSXYwK7PuPjsmGnWk0TZqwKxXsbamDUvCpo0dITS5zcccGkuApeInG8z98GGILmaiwOEtzdKZviJ8rNNqu2FmpzV8RsuYsVA7PyVLqLq2Lhd7MVwd1DEWfnu3jWS1aeguTrsVhK78PXYTZLJT6lyA96l3auVCDNIh3wYVIYXptTGZWrOmG87IyvzYqLWUO+3vcB/fzKDz5HDZWw6DMZazbKWLVBxtwFMrq8IKHnKxI+Xipjdbwi85fI6Pmyoozb4BKEF16SxO8XPEb0ehkz5siIbFsyyIBACUNHylgaTZ+7ScZakk/XyBgzQUaVsJJ+M5HwZGMJk96R8dla5Xr42voOlODrV8y11pHw4SLlfGS7YvGzuoQ5H8tYsExGxy5/AUij1mas2O2PFs+4IEpyxFdGJaNKNnkivJTA6+gko1zg3YPy9pEwf6n2+H+R8KaZ9HwZmQX27Sz8VOHkGbK4s7Vx+EclVr7WP+9fivDfqdkyRoyS7aCwAhd9KiP7VLHx6T05p2WsT5IRXs3+Wrv1lLAvTTlvHf9fym/vi+lmqhBU1LdtB0l8p7wzMoaMsB+nVRtJfId8OvePf/6FJxfrNbcg5rAXlsW5IHWkK84190RukCfaOJX+S52nrxFvzvVGq7YWGO/CXXTtoVwcfym+O/sPljDsDZoA7qW2kwqouM3KjqZBwyShKG5jJTdpbrOORu8TDyXQucRdMv45WcaUd2UkpxT1b/NMUf+X+yv9hTJXyOgXJeGVARJmfqjcCKz0iW8XPRRdI0LCzkMKwMNHZcyaJ2P0eMWixeNCan/tl8Vn2kvIOK705+u2S/lbS0jPUz5j1Li/ACSikQWfHvDF2kxvxGV5YEuKC5KSnDBriQljpxrQf6iMri/KeJo+vFlLCQ2elNCkpQHzNnpi5V4fDBjpCC/vO8cYVhxfWGqOLMbQ2vnL8pfhL9urb1F7j15FiuedTcI6yPez++BxGAA/9q/1f76bhCO5yrl35yoKY5k9X2nbny6jVt2i/v7kPjftUM6xC+OxuZ1dG18P3zz8t1HdNVWxkoTYJAXI9v0yQiqVIZCq9RywaHcAYo74YU2aN9ZleBAYNyRmO2NrjiO255qxM8eInccM2JFFkmHA1jSSLDOSspyQkOmC2cscUJ8fvy8FyJQZyoUdzJJRu15Re9RQ5cuwC7L1s+06SqKNzw0ZoXyZKuGSAMHjsM822yQEPr4S4rcVKZgDNwdijlfsFrfts3c1HKw5PrD7Stgpi802HDvY52sA6zyhBGTeJcVjvTlJAZJGSm7eqgyBhFRzwOyEYCw7UB7Rqf5YneaDdemeWJ/hjnhS9qYsZyQddcDWY2ZszyYwOQbsItltFSOS84zYtN+IQaQ8H587A6lTGpDnitqfLQFIzVoS9mco40yfZb/3gjOt6FhFwZu2yyJ2sDI5fuTeJRDuzzGClc7WxsnCkmhVVsrYnKxYMl8XX1+ZAXH3NmH0x8GYt6MSPtlXAStSymHVEV+sSfdGbDpZS4abCsaJwDhiy1ELth0zKXCyFTgsybmKLFwli4sxm8oOyDvFgZCCV2pAdtwjELICjjPa9bAlpOWqr3mKu02hGHUoS8noRFAvCyAsbV70wfS4MMzZHIoFu8laDgZiJVnLKrKWteleiM3QwLhiI1lMgoDjgM0Ehy2HAWmQduUakZhqxLi3DQirqow/efr9A6lek7KfdGUc3mNuO/fg9JgDL7un+K2yyOpYwX8FCM8ZOEXl8TnL6vQ8TWobUsxsZC/c5q7GHAajAeHdvA8MiKunCb3fDMbUteF4b2NlfLi1EhbtCcLygwEqGMViNFdmhaO6NAaUmOWIRLIgtqKkY2RJ2Y6I3u6AV//HhI8WKxd9P0ACy0vCbfAX5ADr61vUn7Oj5FTlHLsXze/fNZBy9jcOuyzbbK3UVYgGEg4dLUombK2WixLcMxAxVwiw4KXRwRi/sireXheGmZsIzDYCkxwkLGZFij8Ffl8RYzQ4bDkaoA0EiCXeVrII2lE3bCNgmScMwtzvFQjfwTwH4S/Id+Vb02RE1FGyPp5IalmZ5jp4ReBugfirQJ7tJIl0mMfh5KANWQDPU3iSx5PAxs0kSl6K9qx7eauWSde0h26Izs8rE1He28573nms7HsFInwxWUrrnuXw2rxwTIhWwLDFfLClEj7eVVHEmE8PkdUIOH7CcjRA7NoYkiaxGSSZnng3xg3LN1hwjJTLd9NtQE4raaYdkE4KEP6iGhCxzE7vZeVyOwM4kKnMF1iB3BYTJyOwgroC7KAE6dKArFCBJNoA4eTgvQ+U8fhm4Biy9wgJubCDmcrchQFoLkubY/GTj9lqWr9ljyIHMpTvxePcMxDlyTvKsyNc8dzwYLz2cVWymGqYvCacYkwVzEpQ3BnDWby3gsjMGBAnAuzaogkSg1qd7ofl+3zRf5wrfAMMGDtRmSfsOCAL96J91is0ceNAyYp95tmi9tZPS+IL8blXo+yvj+/SZTFKcGVobC3s83nOYTvrZpfFSzP8uXFbZHHn2hae4XjB51jBPr72KfSoN5VJKwdzVqoW5Nnl8pKN7UZOTh7YGjZsVYBwf76mIzkPCIj1gywGAaZdv/KIei8MY5ZWw8SYqpiyVoHDLo2TgI/Irc3fWRELKRlYvDcIS/YHYfJyPzRs42idWLH/r1tfyZQcHO2/fF3K92vXtV+34vUqbuNztsqyDeL16itZDq8hMWQHx9sX/ngCx/3Y5diWxuBzXGqDzzHE25/plRAcosSB9mStfLPwhJY/x9unZH1xZteoibKcwu/rN6jIZY0c8wA3ffIOJa8AB9Ru5YVOQ4IwcEYVjFpMlrOiGt6KCceUNWF4J5ZdWxVMWVUJz0V5w8vf9LdaKr+TMAhepCwXqKy18Uoy3zDDR8nWZZuX+pTRY0Dsztx9LQit7YZmz/tj0PtV8cbi6nhjUTVKCIIQGuF8x83yf0cZ/oYys+e4sWGL4gI198Vxjdsrhz2EfepmByM6DKuM50dVQY2mnrA4GR4rEJrwzwS7DysxRixAnlIXOnPUTO2Zh1Q4wGiijKaqO5w9zI8lCNvkISRUEqvSHTorWVfnrpR8NC05/un1svSai7roQHQguuhAdCC66EB0ILroQHTRgehAdNGB6EB00YHoQP4ONX1lWVTqCQgIEDuilBJNBrHL6V5LL+lA7nWjkKsrpk+fjvz8fLELNz09HTVq1ECbNm3EnvJJkyapxcp0IA9FuNTSjRs3RD0TrpW1ePFisSd9wIABYqcs/zfmj8pKHksgo0ePFoqPi4uD2Wy2lmHSgGzatOk2IPxv/v/Otb4l/nxNY3Gfktyj5hJtRQeiypgxY4Tiz58/j/j4eMTExKBSpUro16/fbUA4vrz22mvCavbt24fly5fjqaeesgPDFeW4+ABve2aXx5XmtKpBrPhx48aJMTds2CCEK9Kx8LZsHYgNEC4ww/vHuUYWxxBbILz9mQM8uzOtOpxWTOa7774TilMernMSkIr3uXTpEtq1ayeAcFUIfg9Xg+B2rVaXbdEzHQgdfJf6+PgIKyjussR+wFatRIGa77//Hj169EB4eLgV0I4dO4SLioyMFHW3Ll++LMpzcNEBthA+tmzZIlyYn5+fsMCgoCABnStCcBUJLkSgA7EBsmrVKrv24kDYVYnaiBs3Wn1+/fr1RREZrr/IFeVGjRplhau5Ma7WwEr/8ssv7cowcYqdkpJiLWBWUkWgxx6IbSwoDoR9Px/skqxb/cgC2P2w6+FajFzyjw+2HOs2CHJ/7Lq++eYbYRlawNeq1e3atUtYph7U/yIQrd/KlSutfbiSEJfzu3jxokiVx48fL/qwm7ItP8v1trjiEEPjNnZVXBWIEwm2Mj3tvQcgvXv3Fv/OzMy0Frjs2bMn/vjjDzGp5NjDNXr5SEtLE/VMxLbrl18WgZuL1Hh4eIhCaFx/i4EMGjRIfCZncSWl0I8lkLFjxwolrl692k4pWmGzhIQEETPYArRyslxWaf78+dbavVz2TxSMDg0VFUz52L59u+jDVsAHV66zWCwi1dUq0nEywONzwOcbQAdCMmLECFGo7JNPPrED0qdPH5FVseVoAbdt27aiFCzf3VyA7KeffhLuiTMnWyWyNWh92F3x2BwnuBLQ7t27xbicDPDrb7/9JvrOnj1bByIKBJD74WKWWsC1bt/z9hYZUpUqVW7rz+VkO3XqhCeeeKLEMktcrIzXwrgPuyi2DG2WzuPx5/HYtsJpcOlArhcW6svvj1549n712pVC6ebN6xeioqJ0pTxi4Th24+b1ixLw+zper+GlAF0xj0ZY91zYH/hvrHTz1g+Nr10rPMu/BehQHg0M1j0xOH/r1o9NyUIg3cLP3RgKUxo4MEr4Mw4yupSdsI7ZTbHOSfeUU//SnVlIhb+lalAaA3+s5Zhy9eqVQo74upSlXCkkXV8Ebqwj3TdhBoW/pUn/B0HdNPO3nZq5AAAAAElFTkSuQmCC'];
        $databaseValue = $type->convertToDatabaseValue($phpValue, $platform);

        $this->assertEquals($phpValue, $type->convertToPHPValue($databaseValue, $platform));
    }
}
